<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use App\SanPham;
class SanPhamController extends Controller
{
    public function getDanhSach()
    {
        $sanpham = SanPham::all();
        return view('admincp.sanpham.danhsach', ['sanpham'=>$sanpham]);
    }

    public function getThem(){
        // $sanpham = SanPham::all();
        return view('admincp.sanpham.them');
    }

    public function postThem(Request $rq){
        $sanpham = new SanPham;
        
        $sanpham->name      = $rq->name;
        $sanpham->anh       = $rq->anh;
        $sanpham->danhgia   = $rq->danhgia;
        $sanpham->gia       = $rq->gia;

        $sanpham->save();

        return redirect()->route('admin.danhsach')->with('success','Thêm sản phẩm thành công.');
    }

    public function getSua($id){
        $sanpham = SanPham::find($id);
        return response()->json(['sanpham'=>$sanpham],200);
        return view('admincp.sanpham.sua', ['sanpham'=>$sanpham]);
    }

    public function postSua(Request $rq, $id){
        $sanpham = SanPham::find($id);

        $validate = Validator::make($request->all(),
        [
            'name' => 'min:3|max;100'
        ],
        [
            'name.min' => "",
            'name.max' => ""
        ]);

        if($validate->fails()){
            return response()->json(['error'=>true, 'messages'=> $validate->error],200);
        }
        $sanpham->name      = $rq->name;
        $sanpham->anh       = $rq->anh;
        $sanpham->danhgia   = $rq->danhgia;
        $sanpham->gia       = $rq->gia;

        $sanpham->save();

        return response()->json(['result'=>"Edit success"],200);
        return redirect()->route('admin.getSua')->with('success','Sửa sản phẩm thành công.');
    }

    public function edit(Request $rq)
    {
        // $sanpham = SanPham::find($id);

        var_dump($rq->id); die;
    }

    public function getXoa($id){
        $sanpham = SanPham::find($id);
        $sanpham->delete();
        return redirect()->route('admin.danhsach')->with('thongbao','Xóa sản phẩm thành công.');
    }
}


@if($errors->has('errorlogin'))
					<div class="alert alert-danger">
						<i class="fas fa-times"></i>
						{{$errors->first('errorlogin')}}
					</div>
				@endif
				<form class="login100-form validate-form" action="{{ route('postDangnhap') }}" method="post">
					<input type="hidden" name="_token" value="{!! csrf_token() !!}"/> 
					<span class="login100-form-title p-b-26">
						Welcome
					</span>
					<span class="login100-form-title p-b-48">
						<i class="zmdi zmdi-font"></i>
					</span>
					@if($errors->has('email'))
					<div class="wrap-input100 validate-input" data-validate = "Valid email is: a@b.c">
						<input class="input100" type="text" name="email">
						<span class="focus-input100" data-placeholder="Email">{{$errors->first('email')}}</span>
					</div>
					@endif
					@if($errors->has('password'))
					<div class="wrap-input100 validate-input" data-validate="Enter password">
						<span class="btn-show-pass">
							<i class="zmdi zmdi-eye"></i>
						</span>
						<input class="input100" type="password" name="pass">
						<span class="focus-input100" data-placeholder="Password">{{$errors->first('password')}}</span>
					</div>
					@endif
					<div class="container-login100-form-btn">
						<div class="wrap-login100-form-btn">
							<div class="login100-form-bgbtn"></div>
							<button class="login100-form-btn" name="login">
								Login
							</button>
						</div>
					</div>







 $rules   = [
            'email'     => 'required|email',
            'pass'  => 'required|min:2|max:32'
        ];

$message = [
    'email.required'    => 'Bạn chưa nhập email',
    'email.email'       => 'Email không phù hợp',
    'pass.password' => 'Bạn chưa nhập mật khẩu',
    'pass.min'      => 'Mật khẩu ít nhất 2 kí tự',
    'pass.max'      => 'Mật khẩu tối đa 32 kí tự'
];






 $this->validate($request,
[
    'email'     => 'required|email',
    'pass'  => 'required|min:2|max:32'
],
[
    'email.required'    => 'Bạn chưa nhập email',
    'email.email'       => 'Email không phù hợp',
    'pass.password' => 'Bạn chưa nhập mật khẩu',
    'pass.min'      => 'Mật khẩu ít nhất 2 kí tự',
    'pass.max'      => 'Mật khẩu tối đa 32 kí tự'
]);

// $admin = new User;
// var_dump($admin->password); die;
// if($request->email == $admin->email && $request->pass == $admin->password ){
//     return redirect()->route('sanpham.index');
// }


if(Auth::attempt(['email'=> $request->email, 'password' => $request->pass])){
    // var_dump($request->pass); die;
    return redirect()->route('sanpham.index');
}
else{
    return redirect('admin/dangnhap');
}





@extends('admincp.layout.index')
<!DOCTYPE html>
<html lang="en">
<head>
	<title>Login V2</title>
    <meta charset="UTF-8">
    <base href="{{asset('')}}">
	<meta name="viewport" content="width=device-width, initial-scale=1">
<!--===============================================================================================-->	
	<link rel="icon" type="image/png" href="{{ asset('login/images/icons/favicon.ico') }}"/>
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="{{ asset('login/vendor/bootstrap/css/bootstrap.min.css') }}">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="{{ asset('login/fonts/font-awesome-4.7.0/css/font-awesome.min.css') }}">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="{{ asset('login/fonts/iconic/css/material-design-iconic-font.min.css') }}">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="{{ asset('login/vendor/animate/animate.css') }}">
<!--===============================================================================================-->	
	<link rel="stylesheet" type="text/css" href="{{ asset('login/vendor/css-hamburgers/hamburgers.min.css') }}">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="{{ asset('login/vendor/animsition/css/animsition.min.css') }}">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="{{ asset('login/vendor/select2/select2.min.css') }}">
<!--===============================================================================================-->	
	<link rel="stylesheet" type="text/css" href="{{ asset('login/vendor/daterangepicker/daterangepicker.css') }}">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="{{ asset('login/css/util.css') }}">
	<link rel="stylesheet" type="text/css" href="{{ asset('login/css/main.css') }}">
<!--===============================================================================================-->
</head>
<body>
	
	<div class="limiter">
		<div class="container-login100">
			<div class="wrap-login100">
				<form class="login100-form validate-form" action="{{ route('postDangnhap') }}" method="post">
					
					<input type="hidden" name="_token" value="{!! csrf_token() !!}"/> 
					<span class="login100-form-title p-b-26">
						Welcome
					</span>
					<span class="login100-form-title p-b-48">
						<i class="zmdi zmdi-font"></i>
					</span>

					<div class="wrap-input100 validate-input" data-validate = "Valid email is: a@b.c">
						<input class="input100" type="text" name="email">
						<span class="focus-input100" data-placeholder="Email"></span>
						@if($errors->has('email'))
							<span class="error1">{{$errors->first('email')}}</span>
						@endif
					</div>

					<div class="wrap-input100 validate-input" data-validate="Enter password">
						<span class="btn-show-pass">
							<i class="zmdi zmdi-eye"></i>
						</span>
						<input class="input100" type="password" name="pass">
						<span class="focus-input100" data-placeholder="Password"></span>
						<!-- @if($errors->has('password'))
							<span class="error1">{{$errors->first('pass')}}</span>
						@endif -->
					</div>

					<div class="container-login100-form-btn">
						<div class="wrap-login100-form-btn">
							<div class="login100-form-bgbtn"></div>
							<button class="login100-form-btn" name="login">
								Login
							</button>
						</div>
					</div>

					<div class="text-center p-t-115">
						<span class="txt1">
							Don’t have an account?
						</span>

						<a class="txt2" href="#">
							Sign Up
						</a>
					</div>
				</form>
			</div>
		</div>
	</div>
	

	<div id="dropDownSelect1"></div>
	
<!--===============================================================================================-->
	<script src="{{ asset('login/vendor/jquery/jquery-3.2.1.min.js') }}"></script>
<!--===============================================================================================-->
	<script src="{{ asset('login/vendor/animsition/js/animsition.min.js') }}"></script>
<!--===============================================================================================-->
	<script src="{{ asset('login/vendor/bootstrap/js/popper.js') }}"></script>
	<script src="{{ asset('login/vendor/bootstrap/js/bootstrap.min.js') }}"></script>
<!--===============================================================================================-->
	<script src="{{ asset('login/vendor/select2/select2.min.js') }}"></script>
<!--===============================================================================================-->
	<script src="{{ asset('login/vendor/daterangepicker/moment.min.js') }}"></script>
	<script src="{{ asset('login/vendor/daterangepicker/daterangepicker.js') }}"></script>
<!--===============================================================================================-->
	<script src="{{ asset('login/vendor/countdowntime/countdowntime.js') }}"></script>
<!--===============================================================================================-->
	<script src="{{ asset('login/js/main.js') }}"></script>

</body>
</html>